import{_ as n,X as s,Y as a,a2 as t}from"./framework.ba356234.js";const p="/assets/images/watermark.png",e={},o=t(`<div class="custom-container tip"><p class="custom-container-title">🌏 简单介绍</p><p>💡 这段时间实现的功能中包含了一个前端页面水印的功能；而这个功能实际应用场景不仅显示，而是为了对业务数据信息实行安全校验的情况；避免部分情况导致的信息泄露而找不到追踪人；虽然从根本完全就解决不了信息泄露的情况，但同时也避免了一些不必要的问题</p></div><p>由于项目是公司老项目【node + jq】，在开发功能之前考虑到页面元素层级嵌套过深，元素定位层级的问题；多多少少也是有不少的坑；</p><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> 页面元素嵌套，每个页面加水印，如何在不改动的前提下优化?</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> 元素定位，有大有小？</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> 背景颜色？ 给 div 设置背景色 background: #fff, 导致水印显示问题?或者元素显示不全？</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-3" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-3"> 不遮挡元素？在元素之下？不影响之前的功能?</label></li></ul><h2 id="实现" tabindex="-1"><a class="header-anchor" href="#实现" aria-hidden="true">#</a> 实现</h2><h3 id="架构-考虑" tabindex="-1"><a class="header-anchor" href="#架构-考虑" aria-hidden="true">#</a> 架构，考虑</h3><p>在改动不大的前提下，去添加一个水印的功能， 那无非写插件方案, 项目中都会引入公共文件，那么在公共文件中写入一个水印的插件，在页面初始化完成之后统一调用即可；</p><p>目前项目中的元素定位 z-index 大小不一，有大有小，导致水印的插件的层级定位问题；如果放在元素之下，先项目的架构方案不适合本水印想法；</p><p>例如，企业微信聊天背景的水印来讲，无非就是一个背景以及 ListView 遮罩覆盖的问题，而公司项目却不适合这样的方案；</p><p>如果指定页面加入水印， 那么水印的功能就废了，加水印的背景就是为了避免视觉的传递上(截图)导致的信息泄露问题，因为每个页面都设计到了用户的部分信息， 那么最好的方案就是每个页面都加水印；</p><p>每个水印都加水印即显示了公司的规范，同时也做到用户在部分操作情况下导致的信息泄露问题；</p><p>既要考虑每个页面都要引入水印，那么我的快乐又来了，项目中使用 iframe 展示不同页面的形式，又在每个页面都会引入公共文件，那么在每个页面的 body 之下加一个特殊展示水印的模块即可；</p><h3 id="确定方案-上手实现" tabindex="-1"><a class="header-anchor" href="#确定方案-上手实现" aria-hidden="true">#</a> 确定方案，上手实现</h3><p>既然是原生项目，那么就不考虑那么多了， 也不考虑自定义的水印方案；这里就不用数据的设计模式了；</p><p>那就简单的写一个方法去实现就好了；因为水印模式就是 透明底色 + 灰色文字 + 转向角度，不必搞得太麻烦；毕竟时间有限；</p><p>首先，定义方法，考虑设计到的技术以及参数；</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 定义方法名 _canvasToWatermark()</span>

<span class="token comment">// 使用 canvas 转背景图实现;</span>

<span class="token comment">// 参数设计到 canvas 定位的元素以及文本样式</span>

<span class="token comment">// 如下：</span>
<span class="token keyword">function</span> <span class="token function">_canvasToWatermark</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	container <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token comment">// 目标元素 root</span>
	width <span class="token operator">=</span> <span class="token string">&quot;450px&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 宽度</span>
	height <span class="token operator">=</span> <span class="token string">&quot;260px&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 高度</span>
	textAlign <span class="token operator">=</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 文本居中</span>
	textBaseline <span class="token operator">=</span> <span class="token string">&quot;middle&quot;</span><span class="token punctuation">,</span>
	font <span class="token operator">=</span> <span class="token string">&quot;14px Helvetica,Arial,sans-serif&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 字体样式</span>
	fillStyle <span class="token operator">=</span> <span class="token string">&quot;rgba(222,221,221,0.5)&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 颜色</span>
	content <span class="token operator">=</span> <span class="token string">&quot;水印&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 文本</span>
	rotate <span class="token operator">=</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 角度</span>
	zIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
	isShowTime <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">_canvasToWatermark</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	container <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">,</span>
	width <span class="token operator">=</span> <span class="token string">&quot;450px&quot;</span><span class="token punctuation">,</span>
	height <span class="token operator">=</span> <span class="token string">&quot;260px&quot;</span><span class="token punctuation">,</span>
	textAlign <span class="token operator">=</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span>
	textBaseline <span class="token operator">=</span> <span class="token string">&quot;middle&quot;</span><span class="token punctuation">,</span>
	font <span class="token operator">=</span> <span class="token string">&quot;14px Helvetica,Arial,sans-serif&quot;</span><span class="token punctuation">,</span>
	fillStyle <span class="token operator">=</span> <span class="token string">&quot;rgba(222,221,221,0.5)&quot;</span><span class="token punctuation">,</span>
	content <span class="token operator">=</span> <span class="token string">&quot;安帮客水印&quot;</span><span class="token punctuation">,</span>
	rotate <span class="token operator">=</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span>
	zIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
	isShowTime <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 设置canvas 的宽度以及高度</span>
	<span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	canvas<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;width&quot;</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span>
	canvas<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ctx.textAlign = textAlign;</span>
	<span class="token comment">// ctx.textBaseline = textBaseline;</span>
	ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> font<span class="token punctuation">;</span>
	ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> fillStyle<span class="token punctuation">;</span>

	ctx<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ctx<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>rotate<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>isShowTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>
			Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">formatDate</span><span class="token punctuation">(</span><span class="token string">&quot;YYYY-MM-DD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">parseFloat</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">,</span>
			<span class="token function">parseFloat</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">20</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">const</span> base64Url <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> abkWm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.abk__wm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> watermarkDiv <span class="token operator">=</span> abkWm <span class="token operator">||</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> styleStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
           position: absolute;
           top:0;
           left:0;
           bottom:0;
           right:0;
           width:100%;
           height:100%;
           z-index: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>zIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
           pointer-events:none;
           background-repeat:repeat;
           background:url(&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>base64Url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
	<span class="token comment">// 不能使用background--image，  避免有的页面 background: #fff 覆盖掉</span>

	watermarkDiv<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;style&quot;</span><span class="token punctuation">,</span> styleStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	watermarkDiv<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;abk__wm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 避免首页与 iframe 元素重叠</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>container<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;abk-wm-empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		container<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>
			<span class="token string">&quot;style&quot;</span><span class="token punctuation">,</span>
			<span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
            height: auto;
            min-height: 100%;
            position: relative;
        </span><span class="token template-punctuation string">\`</span></span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">!</span>abkWm <span class="token operator">&amp;&amp;</span> container<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>watermarkDiv<span class="token punctuation">,</span> container<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> module <span class="token operator">!=</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//CMD</span>
		module<span class="token punctuation">.</span>exports <span class="token operator">=</span> _canvasToWatermark<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">==</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// AMD</span>
		<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> _canvasToWatermark<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		window<span class="token punctuation">.</span>_canvasToWatermark <span class="token operator">=</span> _canvasToWatermark<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">_canvasToWatermark</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;水印！！！&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="上图" tabindex="-1"><a class="header-anchor" href="#上图" aria-hidden="true">#</a> 上图</h2><figure><img src="`+p+'" alt="水印演示效果  " tabindex="0" loading="lazy"><figcaption>水印演示效果 </figcaption></figure>',19),c=[o];function i(l,u){return s(),a("div",null,c)}const r=n(e,[["render",i],["__file","watermark.html.vue"]]);export{r as default};
